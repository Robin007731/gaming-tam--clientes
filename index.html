<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TOURNAMENT MASTER | GAMER NET</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <style>
        :root { --neon: #00f2ff; --bg: #030508; --card: #0d1117; --success: #39FF14; --gold: #ffd700; }
        * { box-sizing: border-box; }
        body { margin: 0; background: var(--bg); color: #fff; font-family: 'Rajdhani', sans-serif; }
        
        /* Pantallas */
        .screen { display: none; min-height: 100vh; flex-direction: column; padding: 20px; padding-bottom: 80px; }
        .active { display: flex; }

        /* Estilo de Torneos (Punto 2.2 y 2.3) */
        .tournament-card { 
            background: var(--card); border-radius: 15px; padding: 20px; 
            margin-bottom: 20px; border: 1px solid #1a1f26; border-left: 5px solid var(--neon);
        }
        .status-badge { font-size: 0.6rem; padding: 3px 8px; border-radius: 4px; background: #000; color: var(--success); border: 1px solid var(--success); }
        
        /* Brackets (Punto 2.5) */
        .bracket-link { color: var(--gold); text-decoration: none; font-family: 'Orbitron'; font-size: 0.7rem; display: block; margin-top: 10px; }

        /* Botones e Inputs */
        input { width: 100%; padding: 12px; margin-bottom: 10px; background: #000; border: 1px solid #222; color: #fff; border-radius: 8px; }
        .btn { width: 100%; padding: 15px; background: var(--neon); border: none; font-family: 'Orbitron'; font-weight: bold; cursor: pointer; border-radius: 8px; transition: 0.3s; }
        
        /* Navbar */
        .navbar { position: fixed; bottom: 0; width: 100%; background: rgba(13,17,23,0.95); display: flex; justify-content: space-around; padding: 15px; border-top: 1px solid var(--neon); }
        .nav-item { color: #555; cursor: pointer; font-size: 0.7rem; font-family: 'Orbitron'; }
        .nav-item.active { color: var(--neon); }
    </style>
</head>
<body>

    <div id="scr-auth" class="screen active" style="justify-content: center; align-items: center;">
        <div style="width:100%; max-width:350px; text-align:center;">
            <h1 style="font-family:'Orbitron'; color:var(--neon)">SISTEMA_LOGIN</h1>
            <input type="email" id="email" placeholder="Email">
            <input type="password" id="pass" placeholder="Password">
            <button class="btn" onclick="login()">INGRESAR</button>
            <p onclick="register()" style="font-size:0.7rem; margin-top:20px; cursor:pointer; color:#666;">¬øNuevo? Crea cuenta con el mismo formulario arriba</p>
        </div>
    </div>

    <div id="scr-list" class="screen">
        <h2 style="font-family:'Orbitron'; color:var(--neon)">TORNEOS DISPONIBLES</h2>
        <div id="tournaments-container">
            </div>
    </div>

    <div id="scr-profile" class="screen" style="text-align:center;">
        <h2 style="font-family:'Orbitron'">MI PERFIL</h2>
        <div style="background:var(--card); padding:20px; border-radius:15px; margin-bottom:20px;">
            <h3 id="p-nick" style="color:var(--neon)">---</h3>
            <p id="p-xp">Puntos: 0 XP</p>
        </div>
        <button class="btn" style="background:#ff3131; color:#fff;" onclick="auth.signOut()">CERRAR SESI√ìN</button>
    </div>

    <nav class="navbar" id="main-nav" style="display:none">
        <div class="nav-item active" onclick="nav('scr-list')">TORNEOS</div>
        <div class="nav-item" onclick="nav('scr-profile')">PERFIL</div>
    </nav>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAyGsnbyvxTEzvtgOXSmU_5Hj6gS6TOWKM",
            authDomain: "gaming-team-18b95.firebaseapp.com",
            projectId: "gaming-team-18b95",
            storageBucket: "gaming-team-18b95.appspot.com",
            messagingSenderId: "89183017486",
            appId: "1:89183017486:web:18b6258a2bf5c0bde97a5f"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        function nav(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
            event.currentTarget.classList.add('active');
        }

        // --- AUTENTICACI√ìN ---
        window.login = () => {
            const e = document.getElementById('email').value.trim();
            const p = document.getElementById('pass').value;
            auth.signInWithEmailAndPassword(e, p).catch(err => alert("Revisa tus datos o reg√≠strate"));
        };

        window.register = () => {
            const e = document.getElementById('email').value.trim();
            const p = document.getElementById('pass').value;
            const nick = prompt("Ingresa tu Gamer Tag (Nick):");
            if(!nick) return;
            auth.createUserWithEmailAndPassword(e, p).then(res => {
                db.collection("usuarios").doc(res.user.uid).set({ nick: nick, puntos: 0, email: e });
            }).catch(err => alert(err.message));
        };

        // --- MOTOR EN TIEMPO REAL ---
        auth.onAuthStateChanged(user => {
            if(user) {
                document.getElementById('scr-auth').classList.remove('active');
                document.getElementById('scr-list').classList.add('active');
                document.getElementById('main-nav').style.display = 'flex';

                // Perfil (Punto 2.1)
                db.collection("usuarios").doc(user.uid).onSnapshot(doc => {
                    if(doc.exists) {
                        document.getElementById('p-nick').innerText = doc.data().nick;
                        document.getElementById('p-xp').innerText = (doc.data().puntos || 0) + " XP";
                    }
                });

                // Carga de Torneos (Punto 2.2, 2.3, 2.4, 2.5)
                db.collection("torneos").onSnapshot(snap => {
                    const cont = document.getElementById('tournaments-container');
                    cont.innerHTML = "";
                    snap.forEach(doc => {
                        const t = doc.data();
                        const isJoined = t.jugadores && t.jugadores.includes(user.uid);

                        cont.innerHTML += `
                            <div class="tournament-card">
                                <div style="display:flex; justify-content:space-between">
                                    <span class="status-badge">ACTIVO</span>
                                    <span style="font-family:'Orbitron'; font-size:0.7rem;">CUPOS: ${t.inscritos_count || 0}/${t.capacidad}</span>
                                </div>
                                <h3 style="margin:10px 0; font-family:'Orbitron'; color:var(--neon)">${t.nombre}</h3>
                                <p style="font-size:0.8rem; color:#888;">${t.desc}</p>
                                
                                ${t.bracket_url ? `<a href="${t.bracket_url}" target="_blank" class="bracket-link">üìä VER ENFRENTAMIENTOS (BRACKETS)</a>` : ''}
                                
                                <button class="btn" 
                                    style="margin-top:15px; background:${isJoined ? '#222' : 'var(--neon)'}; color:${isJoined ? '#555' : '#000'}"
                                    onclick="joinTournament('${doc.id}', ${isJoined})"
                                    ${isJoined ? 'disabled' : ''}>
                                    ${isJoined ? 'YA EST√ÅS INSCRITO' : 'INSCRIBIRSE AHORA'}
                                </button>
                            </div>
                        `;
                    });
                });
            } else {
                document.getElementById('main-nav').style.display = 'none';
                document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
                document.getElementById('scr-auth').classList.add('active');
            }
        });

        // --- INSCRIPCI√ìN Y CONFIRMACI√ìN (Punto 2.4) ---
        window.joinTournament = (tournamentId, alreadyJoined) => {
            if(alreadyJoined) return;
            const user = auth.currentUser;

            db.collection("torneos").doc(tournamentId).update({
                jugadores: firebase.firestore.FieldValue.arrayUnion(user.uid),
                inscritos_count: firebase.firestore.FieldValue.increment(1)
            }).then(() => {
                alert("¬°INSCRIPCI√ìN CONFIRMADA! Te enviamos una notificaci√≥n interna.");
            });
        };
    </script>
</body>
</html>
