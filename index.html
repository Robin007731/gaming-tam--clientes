<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ARENA NEON | ELITE GAMING</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root { --neon-cyan: #00f2ff; --neon-pink: #ff00ff; --bg-dark: #06080c; }
        * { -webkit-tap-highlight-color: transparent; box-sizing: border-box; }
        body { 
            background: var(--bg-dark); color: white; font-family: 'Rajdhani', sans-serif;
            background-image: radial-gradient(circle at top right, rgba(0, 242, 255, 0.05), transparent),
                              linear-gradient(to bottom, rgba(6,8,12,0.95), rgba(6,8,12,0.98)), 
                              url('https://images.unsplash.com/photo-1542751371-adc38448a05e?q=80&w=2070');
            background-size: cover; background-attachment: fixed;
            margin: 0; overflow-x: hidden;
        }
        .font-orbitron { font-family: 'Orbitron', sans-serif; }
        .neon-panel { background: rgba(13, 17, 23, 0.9); backdrop-filter: blur(15px); border: 1px solid rgba(255, 255, 255, 0.05); border-left: 3px solid var(--neon-cyan); }
        
        /* BOTONES */
        .btn-arena {
            border: 2px solid var(--neon-pink); background: transparent; color: white;
            padding: 14px 28px; font-weight: 800; font-family: 'Orbitron'; font-size: 10px;
            text-transform: uppercase; letter-spacing: 2px; clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%);
            transition: 0.4s; cursor: pointer; display: inline-block;
        }
        .btn-arena:hover { background: var(--neon-pink); color: black; box-shadow: 0 0 25px var(--neon-pink); }

        /* GALER√çA DE AVATARES MEJORADA */
        .avatar-grid {
            display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px;
            max-height: 250px; overflow-y: auto; padding: 10px;
            background: rgba(0,0,0,0.5); border-radius: 8px; border: 1px solid rgba(255,255,255,0.05);
        }
        .avatar-grid::-webkit-scrollbar { width: 4px; }
        .avatar-grid::-webkit-scrollbar-thumb { background: var(--neon-cyan); border-radius: 10px; }

        .avatar-option { 
            width: 100%; aspect-ratio: 1; border: 2px solid transparent; 
            transition: 0.2s; cursor: pointer; border-radius: 8px; padding: 2px;
            background: rgba(255,255,255,0.02);
        }
        .avatar-option:hover { background: rgba(0,242,255,0.1); transform: scale(1.1); }
        .avatar-option.selected { border-color: var(--neon-cyan); box-shadow: 0 0 15px var(--neon-cyan); background: rgba(0,242,255,0.2); }
        
        .view-section { display: none; min-height: 100vh; padding-top: 100px; padding-bottom: 120px; }
        .view-section.active { display: block; animation: fadeInUp 0.5s ease-out; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .wa-float { position: fixed; bottom: 100px; right: 20px; background: #25d366; width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; z-index: 99; }
    </style>
</head>
<body>

    <a href="https://chat.whatsapp.com/TU_CODIGO_AQUI" target="_blank" class="wa-float shadow-2xl">
        <svg fill="white" width="30" height="30" viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/></svg>
    </a>

    <div id="auth-screen" class="fixed inset-0 z-[100] flex items-center justify-center bg-[#06080c] p-4 overflow-y-auto">
        <div class="neon-panel p-6 rounded-xl w-full max-w-md border-t-2 border-t-cyan-500 shadow-2xl my-auto">
            <div class="text-center mb-4">
                <h2 class="font-orbitron text-2xl font-black italic tracking-tighter">ARENA <span class="text-cyan-400">NEON</span></h2>
                <p id="auth-mode-text" class="text-[9px] text-zinc-500 uppercase tracking-[0.4em] mt-2">Protocolo de Registro</p>
            </div>

            <form id="reg-form" class="space-y-3">
                <div id="avatar-section">
                    <label class="text-[9px] text-cyan-400 font-bold uppercase mb-2 block tracking-widest text-center">Selecciona tu Avatar de Guerra</label>
                    <div id="avatar-container" class="avatar-grid mb-4">
                        </div>
                </div>

                <input id="reg-name" type="text" placeholder="NOMBRE DE GUERRERO" required class="w-full bg-black/60 p-3 rounded text-xs border border-white/10 outline-none focus:border-cyan-400 font-bold uppercase">
                <input id="reg-email" type="email" placeholder="CORREO ELECTR√ìNICO" required class="w-full bg-black/60 p-3 rounded text-xs border border-white/10 outline-none focus:border-cyan-400 font-bold">
                <input id="reg-pass" type="password" placeholder="CONTRASE√ëA" required class="w-full bg-black/60 p-3 rounded text-xs border border-white/10 outline-none focus:border-cyan-400 font-bold">
                <button type="submit" class="w-full btn-arena">Inicializar Terminal</button>
            </form>

            <div class="mt-4 text-center">
                <button onclick="toggleAuth()" id="btn-toggle" class="text-[9px] text-zinc-500 hover:text-cyan-400 uppercase font-bold tracking-widest">¬øYa tienes cuenta? Iniciar Sesi√≥n</button>
            </div>
        </div>
    </div>

    <div id="main-app" class="hidden">
        <header class="fixed top-0 w-full z-50 bg-black/80 backdrop-blur-xl border-b border-white/5 px-6 py-4 flex justify-between items-center">
            <h1 class="font-orbitron text-sm font-black italic">A_NEON</h1>
            <div class="flex items-center gap-3">
                <span id="nav-user-display" class="text-[9px] font-bold text-cyan-400 uppercase"></span>
                <button onclick="logout()" class="text-red-500 text-[9px] font-black uppercase">Salir</button>
            </div>
        </header>

        <section id="view-inicio" class="view-section active flex items-center justify-center p-6 text-center">
            <div>
                <h2 class="text-5xl font-black font-orbitron mb-6 italic tracking-tighter">BIENVENIDO <br> <span id="welcome-name" class="text-cyan-400 uppercase">GUERRERO</span></h2>
                <button onclick="showView('torneos')" class="btn-arena">Explorar Batallas</button>
            </div>
        </section>

        <section id="view-torneos" class="view-section px-6 md:px-24">
            <h3 class="font-orbitron text-2xl mb-8 border-l-4 border-cyan-400 pl-4">TORNEOS_LIVE</h3>
            <div id="grid-torneos" class="grid grid-cols-1 md:grid-cols-3 gap-6"></div>
        </section>

        <section id="view-perfil" class="view-section px-6 max-w-xl mx-auto">
            <div class="neon-panel p-10 rounded-xl text-center">
                <img id="p-img" class="w-24 h-24 rounded-full mx-auto border-2 border-cyan-400 mb-4">
                <h4 id="p-nombre" class="font-orbitron text-2xl font-black uppercase"></h4>
                <p id="p-xp-display" class="text-cyan-400 font-bold mt-2"></p>
            </div>
        </section>

        <nav class="fixed bottom-0 w-full z-50 bg-black/95 border-t border-white/10 flex justify-around py-4">
            <button onclick="showView('inicio')" class="text-xl">üè†</button>
            <button onclick="showView('torneos')" class="text-xl">‚öîÔ∏è</button>
            <button onclick="showView('perfil')" class="text-xl">üë§</button>
        </nav>
    </div>

    <script>
        const _supa = supabase.createClient('https://qxvqxdsfcvdmanxtzmkn.supabase.co', 'sb_publishable_X2_itSXVSMUgkZeDLSE3KQ_HxD1Jf07');
        
        let isLoginMode = false;
        let selectedAvatarUrl = "https://api.dicebear.com/7.x/bottts/svg?seed=1";

        // --- GENERADOR DE 60 AVATARES ---
        function generateAvatars() {
            const container = document.getElementById('avatar-container');
            container.innerHTML = "";
            
            // Generamos 65 avatares variados
            for(let i = 1; i <= 65; i++) {
                const seed = i;
                const url = `https://api.dicebear.com/7.x/bottts/svg?seed=${seed}&backgroundColor=b6e3f4,c0aede,d1d4f9`;
                const img = document.createElement('img');
                img.src = url;
                img.className = `avatar-option ${i === 1 ? 'selected' : ''}`;
                img.onclick = function() {
                    document.querySelectorAll('.avatar-option').forEach(a => a.classList.remove('selected'));
                    this.classList.add('selected');
                    selectedAvatarUrl = url;
                };
                container.appendChild(img);
            }
        }
        generateAvatars();

        function toggleAuth() {
            isLoginMode = !isLoginMode;
            document.getElementById('auth-mode-text').innerText = isLoginMode ? "Protocolo de Acceso" : "Protocolo de Registro";
            document.getElementById('reg-name').style.display = isLoginMode ? "none" : "block";
            document.getElementById('avatar-section').style.display = isLoginMode ? "none" : "block";
            document.getElementById('btn-toggle').innerText = isLoginMode ? "¬øNo tienes cuenta? Registrarse" : "¬øYa tienes cuenta? Iniciar Sesi√≥n";
        }

        document.getElementById('reg-form').onsubmit = async (e) => {
            e.preventDefault();
            const email = document.getElementById('reg-email').value;
            const pass = document.getElementById('reg-pass').value;
            const name = document.getElementById('reg-name').value;

            if (isLoginMode) {
                const { error } = await _supa.auth.signInWithPassword({ email, password: pass });
                if(error) alert("ERROR: Datos incorrectos.");
            } else {
                const { data, error } = await _supa.auth.signUp({ email, password: pass });
                if(error) return alert("ERROR: " + error.message);
                if(data.user) {
                    await _supa.from('perfiles').insert({
                        id: data.user.id,
                        nombre: name.toUpperCase(),
                        avatar_url: selectedAvatarUrl,
                        xp: 0, victorias: 0
                    });
                    alert("¬°GUERRERO CREADO!");
                }
            }
        };

        _supa.auth.onAuthStateChange(async (event, session) => {
            if (session) {
                const { data: profile } = await _supa.from('perfiles').select('*').eq('id', session.user.id).single();
                if (profile?.baneado) { await _supa.auth.signOut(); return; }
                
                document.getElementById('auth-screen').classList.add('hidden');
                document.getElementById('main-app').classList.remove('hidden');
                
                document.getElementById('welcome-name').innerText = profile?.nombre || "GUERRERO";
                document.getElementById('nav-user-display').innerText = profile?.nombre;
                document.getElementById('p-nombre').innerText = profile?.nombre;
                document.getElementById('p-img').src = profile?.avatar_url;
                document.getElementById('p-xp-display').innerText = profile?.xp + " XP";
            } else {
                document.getElementById('auth-screen').classList.remove('hidden');
                document.getElementById('main-app').classList.add('hidden');
            }
        });

        function showView(v) {
            document.querySelectorAll('.view-section').forEach(s => s.classList.remove('active'));
            document.getElementById('view-' + v).classList.add('active');
            if(v === 'torneos') cargarTorneos();
        }

        async function cargarTorneos() {
            const { data } = await _supa.from('torneos').select('*');
            document.getElementById('grid-torneos').innerHTML = data.map(t => `
                <div class="neon-panel p-6 rounded-lg">
                    <h4 class="font-orbitron font-bold uppercase">${t.nombre}</h4>
                    <p class="text-[9px] text-cyan-400 mt-1 uppercase">${t.juego}</p>
                    <button class="w-full btn-arena py-2 mt-4 text-[8px]">Inscribirse</button>
                </div>
            `).join('');
        }

        async function logout() { await _supa.auth.signOut(); location.reload(); }
    </script>
</body>
</html>
