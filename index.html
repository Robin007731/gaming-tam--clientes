<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title> ZONA GAMER| EHUB </title>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;700&family=Orbitron:wght@700&display=swap" rel="stylesheet">
    <style>
        :root { 
            --bg: #050608; --card: #0d1117; --neon: #00f2ff; --text: #ffffff; 
            --success: #39FF14; --error: #ff3e3e; --gold: #ffcc00; 
            --glass: rgba(255, 255, 255, 0.05); 
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { 
            margin: 0; background: var(--bg); color: var(--text); 
            font-family: 'Rajdhani', sans-serif; overflow-x: hidden; height: 100vh;
        }

        /* --- PANTALLA DE CARGA --- */
        #splash {
            position: fixed; inset: 0; background: var(--bg); z-index: 9999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .loader-logo { 
            font-family: 'Orbitron'; font-size: 2.2rem; color: var(--neon); 
            text-shadow: 0 0 20px var(--neon); animation: pulse 1.5s infinite; 
        }

        /* --- PANTALLA DE AUTH --- */
        #auth-screen {
            position: fixed; inset: 0; background: radial-gradient(circle at center, #0a1921 0%, #030406 100%);
            display: none; align-items: center; justify-content: center; z-index: 8000; padding: 20px;
        }
        .auth-card { 
            background: var(--card); width: 100%; max-width: 400px; padding: 30px; 
            border-radius: 25px; border: 1px solid rgba(0, 242, 255, 0.2); 
            box-shadow: 0 20px 50px rgba(0,0,0,0.8); 
        }
        .input-box { margin-bottom: 15px; }
        label { display: block; font-size: 0.65rem; font-family: 'Orbitron'; color: var(--neon); margin-bottom: 5px; }
        input { 
            width: 100%; padding: 12px; background: rgba(0,0,0,0.5); 
            border: 1px solid #222; color: #fff; border-radius: 10px; 
            font-family: 'Rajdhani'; border-left: 3px solid var(--neon);
        }
        .btn-main { 
            width: 100%; padding: 16px; background: var(--neon); color: #000; 
            border: none; border-radius: 12px; font-family: 'Orbitron'; 
            font-weight: bold; cursor: pointer; margin-top: 10px;
        }

        /* --- APP INTERFACE --- */
        #app { display: none; padding-bottom: 90px; }
        nav { 
            position: sticky; top: 0; background: rgba(13, 17, 23, 0.9); 
            backdrop-filter: blur(10px); padding: 15px 20px; 
            border-bottom: 1px solid rgba(0,242,255,0.2); 
            display: flex; justify-content: space-between; align-items: center; z-index: 1000; 
        }
        .nav-avatar { width: 38px; height: 38px; border-radius: 50%; border: 2px solid var(--neon); object-fit: cover; }

        .section { display: none; padding: 20px; max-width: 500px; margin: 0 auto; animation: slideUp 0.4s ease forwards; }
        .section.active { display: block; }

        /* MISIONES */
        .post { background: var(--card); border-radius: 20px; margin-bottom: 20px; border: 1px solid #1f2937; overflow: hidden; }
        .post-body { padding: 20px; }
        .post-title { font-family: 'Orbitron'; font-size: 1.1rem; color: #fff; margin: 0; }
        .btn-action { width: 100%; padding: 14px; border-radius: 12px; border: none; font-family: 'Orbitron'; font-weight: bold; cursor: pointer; margin-top: 15px; }
        .state-unirme { background: var(--neon); color: #000; }
        .state-inscrito { background: rgba(57, 255, 20, 0.1); color: var(--success); border: 1px solid var(--success); }
        .state-abandonar { background: var(--error); color: #fff; animation: shake 0.2s infinite; }

        /* PERFIL */
        .progress-container { background: #000; height: 10px; border-radius: 10px; margin: 10px 0; overflow: hidden; }
        .progress-bar { height: 100%; background: var(--neon); width: 0%; transition: 0.8s; }
        .avatar-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin: 20px 0; }
        .avatar-opt { width: 100%; border-radius: 50%; border: 2px solid transparent; cursor: pointer; }
        .avatar-opt.selected { border-color: var(--neon); box-shadow: 0 0 10px var(--neon); }

        /* RANKING */
        .rank-item { display: flex; align-items: center; gap: 15px; padding: 12px; background: var(--glass); border-radius: 15px; margin-bottom: 8px; border: 1px solid #1f2937; }
        
        /* MENU INFERIOR */
        .tab-bar { position: fixed; bottom: 0; width: 100%; background: #0d1117; display: flex; border-top: 1px solid #1f2937; padding: 10px 0; z-index: 1000; }
        .tab { flex: 1; text-align: center; font-family: 'Orbitron'; font-size: 0.6rem; color: #555; cursor: pointer; }
        .tab.active { color: var(--neon); }

        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-3px); } 75% { transform: translateX(3px); } }
    </style>
</head>
<body>

    <div id="splash">
        <div class="loader-logo">ZONA GAMER</div>
        <p style="font-family:'Orbitron'; font-size:0.6rem; color:#444; margin-top:15px; letter-spacing:5px;">SISTEMA OPERATIVO v3.0</p>
    </div>

    <div id="auth-screen">
        <div class="auth-card">
            <h2 id="auth-title" style="text-align:center; font-family:'Orbitron'; color:var(--neon); margin-bottom:20px;">ACCESO</h2>
            <div id="auth-form"></div>
            <div style="text-align:center; margin-top:20px; font-size:0.8rem;">
                <span id="auth-msg">¿Eres nuevo?</span> 
                <b id="auth-btn-toggle" onclick="toggleAuth()" style="color:var(--neon); cursor:pointer; margin-left:5px;">REGÍSTRATE</b>
            </div>
        </div>
    </div>

    <div id="app">
        <nav>
            <div style="font-family:'Orbitron'; font-weight:700;">ZONA <span style="color:var(--neon)">GAMER</span></div>
            <div style="display:flex; align-items:center; gap:12px;" onclick="switchTab('sec-perfil')">
                <div style="text-align:right"><b id="nav-pts" style="color:var(--success); display:block; line-height:1;">0</b><small style="font-size:0.5rem; color:#555;">PTS</small></div>
                <img id="nav-img" class="nav-avatar" src="">
            </div>
        </nav>

        <div id="sec-feed" class="section active">
            <h2 style="font-family:'Orbitron'; font-size:0.7rem; color:#555; margin-bottom:15px;">MISIONES ACTIVAS</h2>
            <div id="feed-list"></div>
        </div>

        <div id="sec-rank" class="section">
            <h2 style="font-family:'Orbitron'; font-size:0.7rem; color:#555; margin-bottom:15px;">TOP 20 OPERATIVOS</h2>
            <div id="rank-list"></div>
        </div>

        <div id="sec-perfil" class="section">
            <div style="background: var(--card); padding: 25px; border-radius: 25px; border: 1px solid #1f2937; text-align:center;">
                <img id="p-img" style="width:100px; height:100px; border-radius:50%; border:3px solid var(--neon); margin-bottom:10px;" src="">
                <h2 id="p-nick" style="margin:0; font-family:'Orbitron';">---</h2>
                <div id="p-nivel" style="color:var(--neon); font-family:'Orbitron'; font-size:0.65rem; margin-top:5px;">NIVEL 1</div>

                <div style="margin:20px 0; text-align:left;">
                    <div style="display:flex; justify-content:space-between; font-size:0.6rem; font-family:'Orbitron';">
                        <span>PROGRESO</span> <span id="p-percent">0%</span>
                    </div>
                    <div class="progress-container"><div id="p-bar" class="progress-bar"></div></div>
                </div>

                <small style="color:#444; font-family:'Orbitron'; font-size:0.55rem;">SELECCIONAR AVATAR</small>
                <div class="avatar-grid" id="avatar-selector"></div>

                <button class="btn-action" onclick="contactAdmin()" style="background:#25D366; color:#fff;">SOPORTE WHATSAPP</button>
                <button onclick="logout()" style="background:none; border:none; color:#444; font-family:'Orbitron'; font-size:0.6rem; cursor:pointer; margin-top:20px;">DESCONECTAR</button>
            </div>
        </div>

        <div class="tab-bar">
            <div class="tab active" onclick="switchTab('sec-feed', this)">MISIONES</div>
            <div class="tab" onclick="switchTab('sec-rank', this)">RANKING</div>
            <div class="tab" onclick="switchTab('sec-perfil', this)">PERFIL</div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, setDoc, onSnapshot, updateDoc, arrayUnion, arrayRemove, increment, collection, query, where, getDocs, orderBy, limit } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAyGsnbyvxTEzvtgOXSmU_5Hj6gS6TOWKM",
            authDomain: "gaming-team-18b95.firebaseapp.com",
            projectId: "gaming-team-18b95",
            storageBucket: "gaming-team-18b95.appspot.com",
            messagingSenderId: "89183017486",
            appId: "1:89183017486:web:18b6258a2bf5c0bde97a5f"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        let currentUser = null;
        let isLogin = true;
        let confirmID = null;

        const AVATARES = [
            "https://api.dicebear.com/7.x/adventurer/svg?seed=Felix", "https://api.dicebear.com/7.x/adventurer/svg?seed=Aneka",
            "https://api.dicebear.com/7.x/adventurer/svg?seed=Jack", "https://api.dicebear.com/7.x/adventurer/svg?seed=Milo",
            "https://api.dicebear.com/7.x/adventurer/svg?seed=Luna", "https://api.dicebear.com/7.x/adventurer/svg?seed=Buddy"
        ];

        window.onload = () => {
            const savedUID = localStorage.getItem('squad_uid');
            setTimeout(() => {
                if(savedUID) loadApp(savedUID);
                else { 
                    document.getElementById('splash').style.display = 'none'; 
                    document.getElementById('auth-screen').style.display = 'flex'; 
                    renderForm(); 
                }
            }, 2000);
        };

        window.toggleAuth = () => { isLogin = !isLogin; renderForm(); };

        window.renderForm = () => {
            const form = document.getElementById('auth-form');
            if(isLogin) {
                document.getElementById('auth-title').innerText = "ACCESO";
                document.getElementById('auth-msg').innerText = "¿Eres nuevo?";
                document.getElementById('auth-btn-toggle').innerText = "REGÍSTRATE";
                form.innerHTML = `
                    <div class="input-box"><label>CORREO</label><input type="email" id="l-email"></div>
                    <div class="input-box"><label>CONTRASEÑA</label><input type="password" id="l-pass"></div>
                    <button class="btn-main" onclick="handleLogin()">ENTRAR AL NÚCLEO</button>`;
            } else {
                document.getElementById('auth-title').innerText = "REGISTRO";
                document.getElementById('auth-msg').innerText = "¿Ya tienes cuenta?";
                document.getElementById('auth-btn-toggle').innerText = "LOGIN";
                form.innerHTML = `
                    <div class="input-box"><label>NICK NAME</label><input type="text" id="r-nick"></div>
                    <div class="input-box"><label>WHATSAPP</label><input type="number" id="r-wa"></div>
                    <div class="input-box"><label>CORREO</label><input type="email" id="r-email"></div>
                    <div class="input-box"><label>CONTRASEÑA</label><input type="password" id="r-pass"></div>
                    <button class="btn-main" onclick="handleRegister()">CREAR OPERATIVO</button>`;
            }
        };

        window.handleRegister = async () => {
            const email = document.getElementById('r-email').value;
            const nick = document.getElementById('r-nick').value;
            const pass = document.getElementById('r-pass').value;
            const wa = document.getElementById('r-wa').value;
            if(!email || !nick || !pass) return alert("Completa los datos");
            
            const q = query(collection(db, "usuarios"), where("email", "==", email));
            const snap = await getDocs(q);
            if(!snap.empty) return alert("El correo ya existe");

            const uid = "USR-" + Date.now();
            await setDoc(doc(db, "usuarios", uid), { uid, email, pass, nick, whatsapp: wa, puntos: 0, avatar: AVATARES[0] });
            localStorage.setItem('squad_uid', uid); 
            window.location.reload();
        };

        window.handleLogin = async () => {
            const email = document.getElementById('l-email').value;
            const pass = document.getElementById('l-pass').value;
            const q = query(collection(db, "usuarios"), where("email", "==", email), where("pass", "==", pass));
            const snap = await getDocs(q);
            if(snap.empty) alert("Credenciales incorrectas");
            else { 
                localStorage.setItem('squad_uid', snap.docs[0].id); 
                window.location.reload(); 
            }
        };

        function loadApp(uid) {
            onSnapshot(doc(db, "usuarios", uid), d => {
                if(!d.exists()) { logout(); return; }
                currentUser = d.data(); updateUI();
                document.getElementById('splash').style.display = 'none';
                document.getElementById('auth-screen').style.display = 'none';
                document.getElementById('app').style.display = 'block';
            });
            onSnapshot(doc(db, "config", "global"), d => { 
                if(d.exists()) document.documentElement.style.setProperty('--neon', d.data().colorNeon); 
            });
            initFeed(); initRank();
        }

        function updateUI() {
            document.getElementById('nav-pts').innerText = currentUser.puntos;
            document.getElementById('nav-img').src = currentUser.avatar;
            document.getElementById('p-img').src = currentUser.avatar;
            document.getElementById('p-nick').innerText = currentUser.nick;
            
            const p = currentUser.puntos;
            let nivel = "RECLUTA"; let pct = (p/100)*100;
            if(p >= 100) { nivel = "ESPECIALISTA"; pct = ((p-100)/400)*100; }
            if(p >= 500) { nivel = "ELITE"; pct = ((p-500)/1000)*100; }
            document.getElementById('p-nivel').innerText = nivel;
            document.getElementById('p-bar').style.width = Math.min(pct, 100) + "%";
            document.getElementById('p-percent').innerText = Math.floor(Math.min(pct, 100)) + "%";

            const sel = document.getElementById('avatar-selector'); sel.innerHTML = "";
            AVATARES.forEach(url => {
                const img = document.createElement('img'); img.src = url;
                img.className = `avatar-opt ${currentUser.avatar === url ? 'selected' : ''}`;
                img.onclick = async () => { await updateDoc(doc(db, "usuarios", currentUser.uid), { avatar: url }); };
                sel.appendChild(img);
            });
        }

        function initFeed() {
            onSnapshot(collection(db, "torneos"), snap => {
                const list = document.getElementById('feed-list'); list.innerHTML = "";
                snap.forEach(ds => {
                    const t = ds.data(); if(t.estado !== 'activo') return;
                    const ya = (t.jugadores || []).some(j => j.uid === currentUser.uid);
                    list.innerHTML += `
                        <div class="post"><div class="post-body">
                            <h3 class="post-title">${t.nombre}</h3>
                            <p style="color:#666; font-size:0.8rem; margin:10px 0;">${t.desc}</p>
                            <button id="btn-${ds.id}" class="btn-action ${ya ? 'state-inscrito' : 'state-unirme'}" onclick="handleJoin('${ds.id}', ${ya})">
                                ${ya ? '✓ INSCRITO' : 'UNIRME AHORA'}
                            </button>
                        </div></div>`;
                });
            });
        }

        window.handleJoin = async (id, ya) => {
            if(!ya) await updateDoc(doc(db, "torneos", id), { jugadores: arrayUnion({ uid: currentUser.uid, nick: currentUser.nick, avatar: currentUser.avatar }), inscritos_count: increment(1) });
            else {
                const btn = document.getElementById(`btn-${id}`);
                if(confirmID !== id) { 
                    confirmID = id; btn.innerText = "¿ABANDONAR?"; btn.classList.add('state-abandonar');
                    setTimeout(()=> { confirmID = null; btn.innerText = "✓ INSCRITO"; btn.classList.remove('state-abandonar'); }, 3000); 
                }
                else { await updateDoc(doc(db, "torneos", id), { jugadores: arrayRemove({ uid: currentUser.uid, nick: currentUser.nick, avatar: currentUser.avatar }), inscritos_count: increment(-1) }); confirmID = null; }
            }
        };

        function initRank() {
            onSnapshot(query(collection(db, "usuarios"), orderBy("puntos", "desc"), limit(20)), snap => {
                const list = document.getElementById('rank-list'); list.innerHTML = ""; let i = 1;
                snap.forEach(d => {
                    const u = d.data();
                    list.innerHTML += `<div class="rank-item"><div style="width:25px; font-weight:bold;">#${i}</div><img src="${u.avatar}" style="width:30px; border-radius:50%;"><div style="flex:1"><b>${u.nick}</b></div><div style="color:var(--neon)">${u.puntos}</div></div>`;
                    i++;
                });
            });
        }

        window.switchTab = (id, el) => {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            if(el) { document.querySelectorAll('.tab').forEach(t => t.classList.remove('active')); el.classList.add('active'); }
        };

        window.contactAdmin = () => { window.location.href = `https://wa.me/5491122334455?text=Hola Admin, soy ${currentUser.nick}`; };
        window.logout = () => { localStorage.clear(); window.location.reload(); };
    </script>
</body>
</html>

