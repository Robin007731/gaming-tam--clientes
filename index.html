<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ARENA NEON | ULTIMATE GAMING SYSTEM</title>
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root { 
            --neon-cyan: #00f2ff; 
            --neon-pink: #ff00ff; 
            --bg-dark: #06080c; 
            --glass: rgba(13, 17, 23, 0.85);
        }

        * { -webkit-tap-highlight-color: transparent; box-sizing: border-box; outline: none; }
        
        body { 
            background: var(--bg-dark); color: white; font-family: 'Rajdhani', sans-serif;
            background-image: radial-gradient(circle at 50% 0%, rgba(0, 242, 255, 0.08), transparent),
                              url('https://images.unsplash.com/photo-1550745165-9bc0b252726f?q=80&w=2070');
            background-size: cover; background-attachment: fixed; margin: 0; overflow-x: hidden;
        }

        .font-orbitron { font-family: 'Orbitron', sans-serif; }

        /* PANELES NEON */
        .neon-border { border: 1px solid rgba(0, 242, 255, 0.2); box-shadow: 0 0 20px rgba(0, 242, 255, 0.05); }
        .glass-panel { background: var(--glass); backdrop-filter: blur(15px); border: 1px solid rgba(255, 255, 255, 0.05); }

        /* BOTONES DE √âLITE */
        .btn-action {
            position: relative; overflow: hidden;
            border: 2px solid var(--neon-pink); background: transparent; color: white;
            padding: 10px 20px; font-weight: 800; font-family: 'Orbitron'; font-size: 11px;
            text-transform: uppercase; letter-spacing: 2px; transition: 0.3s;
            clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%);
        }
        .btn-action:hover { background: var(--neon-pink); color: black; box-shadow: 0 0 30px var(--neon-pink); transform: scale(1.05); }
        .btn-action:active { transform: scale(0.95); }

        /* SELECTOR DE AVATARES MEJORADO */
        .avatar-grid {
            display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px;
            max-height: 220px; overflow-y: auto; padding: 10px;
            background: rgba(0,0,0,0.5); border-radius: 12px; border: 1px solid rgba(255,255,255,0.1);
        }
        .avatar-grid::-webkit-scrollbar { width: 5px; }
        .avatar-grid::-webkit-scrollbar-thumb { background: var(--neon-cyan); border-radius: 5px; }
        
        .avatar-item { 
            width: 100%; aspect-ratio: 1; border: 2px solid transparent; 
            border-radius: 10px; transition: 0.25s; cursor: pointer; padding: 2px;
        }
        .avatar-item:hover { transform: translateY(-3px); background: rgba(0,242,255,0.1); }
        .avatar-item.selected { border-color: var(--neon-cyan); background: rgba(0,242,255,0.2); box-shadow: 0 0 15px var(--neon-cyan); }

        /* NAVEGACI√ìN Y VISTAS */
        .view-section { display: none; min-height: 100vh; width: 100%; padding-top: 100px; padding-bottom: 100px; }
        .view-section.active { display: block; animation: view-in 0.5s ease forwards; }
        @keyframes view-in { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }

        .nav-tab.active { color: var(--neon-cyan); border-bottom: 2px solid var(--neon-cyan); text-shadow: 0 0 10px var(--neon-cyan); }

        /* WHATSAPP */
        .wa-btn { position: fixed; bottom: 30px; right: 20px; background: #25d366; width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; z-index: 1000; box-shadow: 0 5px 20px rgba(0,0,0,0.5); transition: 0.3s; }
        .wa-btn:hover { transform: rotate(15deg) scale(1.1); }

        /* INPUTS */
        input { transition: 0.3s; }
        input:focus { border-color: var(--neon-cyan) !important; box-shadow: 0 0 10px rgba(0,242,255,0.2); }
    </style>
</head>
<body>

    <a href="https://chat.whatsapp.com/TU_GRUPO_AQUI" target="_blank" class="wa-btn">
        <svg fill="white" width="32" height="32" viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/></svg>
    </a>

    <div id="auth-screen" class="fixed inset-0 z-[1000] flex items-center justify-center bg-[#020408] p-6 overflow-y-auto">
        <div class="glass-panel p-8 rounded-2xl w-full max-w-md border-t-4 border-t-cyan-500 shadow-2xl my-auto">
            <div class="text-center mb-8">
                <h2 class="font-orbitron text-3xl font-black italic tracking-tighter text-white">ARENA <span class="text-cyan-400">NEON</span></h2>
                <p id="auth-subtitle" class="text-[10px] text-zinc-500 uppercase font-bold tracking-[0.4em] mt-2">Iniciando Protocolo de Registro</p>
            </div>

            <form id="auth-form" class="space-y-4">
                <div id="reg-fields">
                    <p class="text-[9px] text-cyan-400 font-bold uppercase mb-3 text-center tracking-widest">Elige tu Identidad Visual</p>
                    <div id="avatar-container" class="avatar-grid mb-6"></div>
                    <input id="u-name" type="text" placeholder="APODO DE COMBATE" class="w-full bg-black/50 p-4 rounded-xl text-xs border border-white/10 outline-none font-bold uppercase mb-2">
                </div>

                <input id="u-email" type="email" placeholder="CORREO ELECTR√ìNICO" required class="w-full bg-black/50 p-4 rounded-xl text-xs border border-white/10 outline-none font-bold">
                <input id="u-pass" type="password" placeholder="CONTRASE√ëA" required class="w-full bg-black/50 p-4 rounded-xl text-xs border border-white/10 outline-none font-bold">
                
                <button type="submit" id="auth-main-btn" class="w-full btn-action py-4">Ingresar a la Arena</button>
            </form>

            <div class="mt-8 text-center border-t border-white/5 pt-6">
                <button onclick="toggleAuth()" id="auth-toggle-btn" class="text-[10px] text-zinc-500 hover:text-cyan-400 uppercase font-bold tracking-widest transition">¬øYa tienes cuenta? Iniciar Sesi√≥n</button>
            </div>
        </div>
    </div>

    <div id="main-app" class="hidden">
        
        <header class="fixed top-0 w-full z-[100] glass-panel border-b border-white/5 px-6 py-4 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 bg-cyan-500 rounded flex items-center justify-center font-black text-black">N</div>
                <h1 class="font-orbitron text-sm font-black hidden md:block">ARENA_NEON</h1>
            </div>
            
            <nav class="flex gap-2 md:gap-6">
                <button onclick="changeView('inicio')" id="btn-nav-inicio" class="nav-tab px-3 py-1 font-bold text-[10px] uppercase active">Inicio</button>
                <button onclick="changeView('torneos')" id="btn-nav-torneos" class="nav-tab px-3 py-1 font-bold text-[10px] uppercase">Torneos</button>
                <button onclick="changeView('ranking')" id="btn-nav-ranking" class="nav-tab px-3 py-1 font-bold text-[10px] uppercase">Ranking</button>
                <button onclick="changeView('perfil')" id="btn-nav-perfil" class="nav-tab px-3 py-1 font-bold text-[10px] uppercase">Perfil</button>
            </nav>

            <button onclick="logout()" class="bg-red-500/10 hover:bg-red-500 text-red-500 hover:text-white px-3 py-1 rounded text-[10px] font-black uppercase transition border border-red-500/20">Salir</button>
        </header>

        <section id="view-inicio" class="view-section active flex items-center justify-center">
            <div class="text-center px-6">
                <span class="inline-block px-4 py-1 bg-cyan-500/10 text-cyan-400 text-[10px] font-black tracking-[0.4em] uppercase rounded-full mb-6 border border-cyan-500/20">Online v4.0.2</span>
                <h2 class="text-6xl md:text-9xl font-black font-orbitron italic tracking-tighter leading-none mb-8">ARENA<br><span class="text-transparent" style="-webkit-text-stroke: 1px white;">NEON.</span></h2>
                <div class="flex flex-col md:flex-row gap-4 justify-center">
                    <button onclick="changeView('torneos')" class="btn-action">Explorar Torneos</button>
                    <button onclick="changeView('ranking')" class="px-8 py-3 text-[11px] font-bold uppercase tracking-widest border border-white/20 hover:bg-white hover:text-black transition">Ver Ranking</button>
                </div>
            </div>
        </section>

        <section id="view-torneos" class="view-section px-6 md:px-24">
            <div class="mb-12">
                <h3 class="font-orbitron text-3xl font-black italic text-cyan-400 uppercase">Batallas_Activas</h3>
                <p class="text-zinc-500 text-xs font-bold uppercase tracking-widest">Selecciona una arena para competir</p>
            </div>
            <div id="torneos-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                </div>
        </section>

        <section id="view-ranking" class="view-section px-6 max-w-4xl mx-auto">
            <div class="text-center mb-12">
                <h3 class="font-orbitron text-3xl font-black italic text-yellow-500 uppercase">Hall_Of_Fame</h3>
                <p class="text-zinc-500 text-xs font-bold uppercase tracking-widest">Los 10 mejores guerreros de la temporada</p>
            </div>
            <div id="ranking-list" class="space-y-4">
                </div>
        </section>

        <section id="view-perfil" class="view-section px-6 flex items-center justify-center">
            <div class="glass-panel p-10 rounded-3xl w-full max-w-lg border-t-2 border-t-cyan-400 shadow-2xl relative overflow-hidden">
                <div class="absolute top-0 right-0 p-4 opacity-10 font-orbitron text-6xl font-black">USER</div>
                
                <div class="text-center relative z-10">
                    <img id="p-avatar" src="" class="w-32 h-32 rounded-full mx-auto border-4 border-cyan-400 p-1 mb-6 bg-black">
                    <h4 id="p-name" class="font-orbitron text-3xl font-black uppercase tracking-tighter">Cargando...</h4>
                    
                    <div class="grid grid-cols-2 gap-6 mt-10">
                        <div class="bg-black/40 p-6 rounded-2xl border border-white/5">
                            <span id="p-xp" class="block text-4xl font-black text-cyan-400">0</span>
                            <span class="text-[10px] text-zinc-500 uppercase font-black tracking-widest">Experiencia</span>
                        </div>
                        <div class="bg-black/40 p-6 rounded-2xl border border-white/5">
                            <span id="p-wins" class="block text-4xl font-black text-pink-500">0</span>
                            <span class="text-[10px] text-zinc-500 uppercase font-black tracking-widest">Victorias</span>
                        </div>
                    </div>

                    <button onclick="openSupport()" class="mt-10 btn-action w-full">Contactar Soporte</button>
                </div>
            </div>
        </section>

        <div id="support-modal" class="hidden fixed inset-0 z-[2000] bg-black/95 flex items-center justify-center p-6">
            <div class="glass-panel p-8 rounded-2xl w-full max-w-md border border-cyan-500/30">
                <h3 class="font-orbitron text-lg font-black mb-6 text-cyan-400 uppercase">Enviar Ticket</h3>
                <input id="s-subject" placeholder="ASUNTO" class="w-full bg-black/50 p-4 mb-4 rounded-xl border border-white/10 text-xs text-white uppercase font-bold outline-none focus:border-cyan-400">
                <textarea id="s-msg" rows="5" placeholder="DETALLES DEL PROBLEMA..." class="w-full bg-black/50 p-4 mb-6 rounded-xl border border-white/10 text-xs text-white font-bold outline-none focus:border-cyan-400"></textarea>
                <div class="flex gap-4">
                    <button onclick="sendTicket()" class="flex-1 btn-action">Enviar</button>
                    <button onclick="closeSupport()" class="px-6 text-xs font-black uppercase text-zinc-500">Cerrar</button>
                </div>
            </div>
        </div>

        <nav class="md:hidden fixed bottom-0 w-full z-[100] glass-panel border-t border-white/10 flex justify-around py-4">
            <button onclick="changeView('inicio')" class="text-2xl">üè†</button>
            <button onclick="changeView('torneos')" class="text-2xl">‚öîÔ∏è</button>
            <button onclick="changeView('ranking')" class="text-2xl">üèÜ</button>
            <button onclick="changeView('perfil')" class="text-2xl">üë§</button>
        </nav>
    </div>

    <script>
        // --- ‚öôÔ∏è CONFIGURACI√ìN CORE ---
        const SUPA_URL = 'https://qxvqxdsfcvdmanxtzmkn.supabase.co';
        const SUPA_KEY = 'sb_publishable_X2_itSXVSMUgkZeDLSE3KQ_HxD1Jf07';
        const _supa = supabase.createClient(SUPA_URL, SUPA_KEY);

        let currentUser = null;
        let isLogin = false;
        let selectedAvatarUrl = "https://api.dicebear.com/7.x/bottts/svg?seed=1";

        // --- üé® GESTI√ìN DE AVATARES ---
        function loadAvatars() {
            const container = document.getElementById('avatar-container');
            container.innerHTML = '';
            for(let i=1; i<=65; i++) {
                const url = `https://api.dicebear.com/7.x/bottts/svg?seed=${i}&backgroundColor=b6e3f4,c0aede,d1d4f9`;
                const img = document.createElement('img');
                img.src = url;
                img.className = `avatar-item ${i===1 ? 'selected' : ''}`;
                img.onclick = () => {
                    document.querySelectorAll('.avatar-item').forEach(el => el.classList.remove('selected'));
                    img.classList.add('selected');
                    selectedAvatarUrl = url;
                };
                container.appendChild(img);
            }
        }
        loadAvatars();

        // --- üîê SISTEMA DE AUTENTICACI√ìN ---
        function toggleAuth() {
            isLogin = !isLogin;
            document.getElementById('auth-subtitle').innerText = isLogin ? "Iniciando Protocolo de Acceso" : "Iniciando Protocolo de Registro";
            document.getElementById('reg-fields').style.display = isLogin ? "none" : "block";
            document.getElementById('auth-toggle-btn').innerText = isLogin ? "¬øNo tienes cuenta? Reg√≠strate" : "¬øYa tienes cuenta? Iniciar Sesi√≥n";
            document.getElementById('auth-main-btn').innerText = isLogin ? "Acceder al Sistema" : "Ingresar a la Arena";
        }

        document.getElementById('auth-form').onsubmit = async (e) => {
            e.preventDefault();
            const email = document.getElementById('u-email').value;
            const pass = document.getElementById('u-pass').value;
            const name = document.getElementById('u-name').value;

            if(isLogin) {
                const { error } = await _supa.auth.signInWithPassword({ email, password: pass });
                if(error) alert("Error: Acceso denegado. Revisa tus credenciales.");
            } else {
                const { data, error } = await _supa.auth.signUp({ email, password: pass });
                if(error) return alert("Error: " + error.message);
                if(data.user) {
                    const { error: pErr } = await _supa.from('perfiles').insert({
                        id: data.user.id,
                        nombre: name.toUpperCase() || "GUERRERO_X",
                        avatar_url: selectedAvatarUrl,
                        xp: 0, victorias: 0
                    });
                    if(!pErr) alert("¬°Cuenta Creada! Bienvenido a la Arena.");
                }
            }
        };

        _supa.auth.onAuthStateChange(async (event, session) => {
            if(session) {
                currentUser = session.user;
                const { data: profile } = await _supa.from('perfiles').select('*').eq('id', currentUser.id).single();
                
                if(profile?.baneado) {
                    document.body.innerHTML = "<div class='h-screen flex items-center justify-center bg-black text-red-500 font-orbitron text-xl'>‚ö†Ô∏è TERMINAL BLOQUEADA POR EL ADMINISTRADOR ‚ö†Ô∏è</div>";
                    await _supa.auth.signOut();
                    return;
                }
                
                document.getElementById('auth-screen').style.display = 'none';
                document.getElementById('main-app').classList.remove('hidden');
                updateProfileUI(profile);
            } else {
                document.getElementById('auth-screen').style.display = 'flex';
                document.getElementById('main-app').classList.add('hidden');
            }
        });

        // --- üìä L√ìGICA DE NAVEGACI√ìN Y VISTAS ---
        function changeView(viewId) {
            // Desactivar todas las secciones y pesta√±as
            document.querySelectorAll('.view-section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            
            // Activar la seleccionada
            document.getElementById('view-' + viewId).classList.add('active');
            const navBtn = document.getElementById('btn-nav-' + viewId);
            if(navBtn) navBtn.classList.add('active');

            // Cargar datos seg√∫n la vista
            if(viewId === 'torneos') fetchTorneos();
            if(viewId === 'ranking') fetchRanking();
            if(viewId === 'perfil') fetchUserData();
            
            window.scrollTo({top: 0, behavior: 'smooth'});
        }

        async function fetchUserData() {
            const { data } = await _supa.from('perfiles').select('*').eq('id', currentUser.id).single();
            if(data) updateProfileUI(data);
        }

        function updateProfileUI(p) {
            document.getElementById('p-name').innerText = p.nombre;
            document.getElementById('p-avatar').src = p.avatar_url;
            document.getElementById('p-xp').innerText = p.xp.toLocaleString();
            document.getElementById('p-wins').innerText = p.victorias;
        }

        async function fetchTorneos() {
            const { data } = await _supa.from('torneos').select('*').order('created_at', {ascending: false});
            const container = document.getElementById('torneos-list');
            if(!data || data.length === 0) {
                container.innerHTML = "<p class='text-zinc-500 font-bold uppercase py-10'>No hay torneos disponibles en este momento.</p>";
                return;
            }
            container.innerHTML = data.map(t => `
                <div class="glass-panel p-6 rounded-2xl border-l-4 border-l-cyan-400 hover:transform hover:scale-[1.02] transition shadow-lg">
                    <div class="flex justify-between items-start mb-4">
                        <span class="bg-cyan-500 text-black px-3 py-1 text-[9px] font-black uppercase rounded">${t.juego}</span>
                        <span class="text-zinc-500 text-[10px] font-bold">#${t.id.slice(0,5)}</span>
                    </div>
                    <h4 class="font-orbitron font-black text-xl mb-4">${t.nombre}</h4>
                    <div class="flex justify-between text-[10px] font-bold uppercase mb-2">
                        <span class="text-zinc-400">Cupos Disponibles</span>
                        <span class="text-cyan-400">${t.inscritos} / ${t.capacidad}</span>
                    </div>
                    <div class="w-full h-1.5 bg-white/5 rounded-full mb-6 overflow-hidden">
                        <div class="h-full bg-cyan-400 shadow-[0_0_10px_#00f2ff]" style="width: ${(t.inscritos/t.capacidad)*100}%"></div>
                    </div>
                    <button class="w-full btn-action">Inscribirme ahora</button>
                </div>
            `).join('');
        }

        async function fetchRanking() {
            const { data } = await _supa.from('perfiles').select('*').order('xp', {ascending: false}).limit(10);
            const container = document.getElementById('ranking-list');
            container.innerHTML = data.map((u, i) => `
                <div class="glass-panel p-4 rounded-xl flex items-center justify-between border border-white/5 hover:border-cyan-500/30 transition">
                    <div class="flex items-center gap-5">
                        <span class="font-orbitron text-2xl font-black w-8 ${i === 0 ? 'text-yellow-400' : i === 1 ? 'text-zinc-300' : i === 2 ? 'text-orange-500' : 'text-zinc-700'}">0${i+1}</span>
                        <img src="${u.avatar_url}" class="w-12 h-12 rounded-full border-2 border-white/10 p-0.5">
                        <div>
                            <p class="font-black uppercase text-sm ${u.id === currentUser.id ? 'text-cyan-400' : 'text-white'}">${u.nombre}</p>
                            <p class="text-[9px] text-zinc-500 font-bold uppercase tracking-widest">${u.victorias} Victorias Totales</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <p class="font-orbitron font-black text-cyan-400 text-lg">${u.xp.toLocaleString()}</p>
                        <p class="text-[8px] text-zinc-600 font-black uppercase">Puntos XP</p>
                    </div>
                </div>
            `).join('');
        }

        // --- üí¨ SOPORTE ---
        function openSupport() { document.getElementById('support-modal').classList.remove('hidden'); }
        function closeSupport() { document.getElementById('support-modal').classList.add('hidden'); }
        async function sendTicket() {
            const subject = document.getElementById('s-subject').value;
            const message = document.getElementById('s-msg').value;
            if(!subject || !message) return alert("Completa todos los campos.");
            
            const { error } = await _supa.from('tickets_soporte').insert({
                user_id: currentUser.id,
                asunto: subject.toUpperCase(),
                mensaje: message
            });
            
            if(!error) {
                alert("üì° TICKET ENVIADO AL COMANDO CENTRAL");
                closeSupport();
                document.getElementById('s-subject').value = '';
                document.getElementById('s-msg').value = '';
            }
        }

        async function logout() { await _supa.auth.signOut(); location.reload(); }
    </script>
</body>
</html>
