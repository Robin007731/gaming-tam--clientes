<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ARENA NEON | ELITE GAMING</title>
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root { --neon-cyan: #00f2ff; --neon-pink: #ff00ff; --bg-dark: #06080c; }
        
        * { -webkit-tap-highlight-color: transparent; box-sizing: border-box; }
        
        body { 
            background: var(--bg-dark); color: white; font-family: 'Rajdhani', sans-serif;
            background-image: radial-gradient(circle at top right, rgba(0, 242, 255, 0.05), transparent),
                              linear-gradient(to bottom, rgba(6,8,12,0.95), rgba(6,8,12,0.98)), 
                              url('https://images.unsplash.com/photo-1542751371-adc38448a05e?q=80&w=2070');
            background-size: cover; background-attachment: fixed;
            margin: 0; overflow-x: hidden;
        }

        .font-orbitron { font-family: 'Orbitron', sans-serif; }

        /* NAVEGACI√ìN */
        .nav-link {
            font-size: 10px; font-weight: 700; text-transform: uppercase; letter-spacing: 2px;
            color: rgba(255,255,255,0.5); transition: 0.3s; position: relative;
            padding: 10px 0;
        }
        .nav-link.active { color: var(--neon-cyan); }
        .nav-link.active::after {
            content: ''; position: absolute; bottom: 0; left: 0; width: 100%; height: 2px;
            background: var(--neon-cyan); box-shadow: 0 0 10px var(--neon-cyan);
        }

        /* BOTONES CYBER */
        .btn-arena {
            border: 2px solid var(--neon-pink); background: transparent; color: white;
            padding: 14px 28px; font-weight: 800; font-family: 'Orbitron'; font-size: 10px;
            text-transform: uppercase; letter-spacing: 2px;
            clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%);
            transition: 0.4s; cursor: pointer; display: inline-block;
        }
        .btn-arena:hover { background: var(--neon-pink); color: black; box-shadow: 0 0 25px var(--neon-pink); transform: scale(1.05); }
        .btn-arena:active { transform: scale(0.95); }

        /* PANELES */
        .neon-panel {
            background: rgba(13, 17, 23, 0.7); backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-left: 3px solid var(--neon-cyan);
            transition: 0.3s;
        }

        /* ANIMACIONES */
        .view-section { display: none; min-height: 100vh; padding-top: 100px; padding-bottom: 120px; }
        .view-section.active { display: block; animation: fadeInUp 0.5s ease-out forwards; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }

        /* WHATSAPP FLOAT */
        .wa-float {
            position: fixed; bottom: 100px; right: 20px;
            background: #25d366; width: 60px; height: 60px;
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            box-shadow: 0 0 25px rgba(37, 211, 102, 0.4); z-index: 99; transition: 0.3s;
        }
        @media (min-width: 768px) { .wa-float { bottom: 40px; right: 40px; } }

        /* HUD STATUS */
        .hud-status {
            width: 140px; height: 140px; border-radius: 50%; border: 3px solid #22c55e;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: rgba(0,0,0,0.8); box-shadow: 0 0 20px rgba(34, 197, 94, 0.3);
            animation: pulse 2s infinite;
        }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.4); } 70% { box-shadow: 0 0 0 20px rgba(34, 197, 94, 0); } 100% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0); } }
    </style>
</head>
<body>

    <a href="https://chat.whatsapp.com/TU_CODIGO_DE_GRUPO" target="_blank" class="wa-float">
        <svg fill="white" width="30" height="30" viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/></svg>
    </a>

    <div id="global-alert" class="hidden fixed top-0 w-full z-[200] bg-red-600 text-white text-[10px] font-black py-3 text-center uppercase tracking-[0.2em] shadow-xl">
        üö® SISTEMA: <span id="alert-msg"></span>
    </div>

    <div id="auth-screen" class="fixed inset-0 z-[100] flex items-center justify-center bg-[#06080c] p-6">
        <div class="neon-panel p-8 rounded-xl w-full max-w-sm text-center border-t-2 border-t-cyan-500 shadow-2xl">
            <h2 class="font-orbitron text-2xl mb-2 italic">ARENA <span class="text-cyan-400">NEON</span></h2>
            <p class="text-[9px] text-zinc-500 uppercase tracking-[0.3em] mb-8">Protocolo de Identificaci√≥n</p>
            
            <form id="auth-form" class="space-y-4">
                <input id="u-email" type="email" placeholder="CORREO@RED.COM" required class="w-full bg-black/50 p-4 rounded text-xs border border-white/10 outline-none focus:border-cyan-400 font-bold">
                <input id="u-pass" type="password" placeholder="CONTRASE√ëA" required class="w-full bg-black/50 p-4 rounded text-xs border border-white/10 outline-none focus:border-cyan-400 font-bold">
                <button type="submit" id="btn-auth" class="w-full btn-arena">Inicializar</button>
            </form>
            <div id="auth-msg" class="mt-4 text-xs font-bold text-pink-500 hidden"></div>
        </div>
    </div>

    <div id="main-app" class="hidden min-h-screen">
        
        <header class="hidden md:flex fixed top-0 w-full z-50 bg-black/70 backdrop-blur-xl border-b border-white/5 px-12 py-4 justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 bg-cyan-500 rounded-sm rotate-45 flex items-center justify-center border border-white">
                    <span class="rotate-[-45deg] text-black font-black text-xs">A</span>
                </div>
                <h1 class="font-orbitron text-md font-black tracking-widest uppercase">Arena <span class="text-cyan-400">Neon</span></h1>
            </div>
            <nav class="flex gap-10">
                <button onclick="showView('inicio')" id="link-inicio" class="nav-link active">Inicio</button>
                <button onclick="showView('torneos')" id="link-torneos" class="nav-link">Torneos</button>
                <button onclick="showView('ranking')" id="link-ranking" class="nav-link">Ranking</button>
                <button onclick="showView('perfil')" id="link-perfil" class="nav-link">Perfil</button>
                <button onclick="showView('soporte')" id="link-soporte" class="nav-link">Soporte</button>
            </nav>
            <div class="flex items-center gap-4">
                <span id="nav-user" class="text-[10px] font-black text-cyan-400 uppercase tracking-tighter"></span>
                <button onclick="logout()" class="text-zinc-500 hover:text-red-500 text-[9px] font-black uppercase">Exit</button>
            </div>
        </header>

        <nav class="md:hidden fixed bottom-0 w-full z-50 bg-black/95 border-t border-white/10 flex justify-around py-4 backdrop-blur-lg">
            <button onclick="showView('inicio')" class="text-xl">üè†</button>
            <button onclick="showView('torneos')" class="text-xl">‚öîÔ∏è</button>
            <button onclick="showView('ranking')" class="text-xl">üèÜ</button>
            <button onclick="showView('perfil')" class="text-xl">üë§</button>
            <button onclick="showView('soporte')" class="text-xl">üí¨</button>
        </nav>

        <section id="view-inicio" class="view-section active flex items-center px-6 md:px-24">
            <div class="grid grid-cols-1 lg:grid-cols-2 w-full gap-16 items-center">
                <div class="text-center lg:text-left">
                    <p class="text-cyan-400 font-bold tracking-[0.4em] text-[10px] uppercase mb-4">Elite Competitive Hub</p>
                    <h2 class="text-5xl md:text-8xl font-black font-orbitron italic leading-[0.9] tracking-tighter mb-10">
                        TU ARENA <br> <span class="text-transparent" style="-webkit-text-stroke: 1px white;">TE ESPERA.</span>
                    </h2>
                    <button onclick="showView('torneos')" class="btn-arena">Explorar Batallas</button>
                </div>
                <div class="flex justify-center">
                    <div class="hud-status">
                        <span class="text-2xl font-black text-white font-orbitron" id="count-online">147k</span>
                        <span class="text-[8px] text-green-500 font-bold uppercase tracking-widest">Online</span>
                    </div>
                </div>
            </div>
        </section>

        <section id="view-torneos" class="view-section px-6 md:px-24">
            <div class="mb-12">
                <h3 class="font-orbitron text-3xl font-black italic">ARENA_LIVE</h3>
                <div class="h-1 w-24 bg-cyan-400 mt-2"></div>
            </div>
            <div id="grid-torneos" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
                </div>
        </section>

        <section id="view-ranking" class="view-section px-6 max-w-3xl mx-auto">
            <h3 class="font-orbitron text-2xl font-black italic mb-10 text-center text-yellow-500">CLASIFICACI√ìN_GLOBAL</h3>
            <div id="list-ranking" class="space-y-4">
                </div>
        </section>

        <section id="view-perfil" class="view-section px-6 max-w-2xl mx-auto">
            <div class="neon-panel p-10 rounded-2xl text-center border-t-2 border-cyan-400">
                <img id="p-img" src="" class="w-28 h-28 rounded-full mx-auto border-2 border-cyan-400 p-1 mb-6 shadow-2xl">
                <h4 id="p-nombre" class="font-orbitron text-2xl font-black uppercase tracking-tight"></h4>
                <p id="p-frase" class="text-zinc-500 text-xs italic mb-10"></p>
                <div class="grid grid-cols-2 gap-6">
                    <div class="bg-black/50 p-6 rounded-xl border border-white/5">
                        <span id="p-xp" class="block text-4xl font-black text-cyan-400 font-orbitron">0</span>
                        <span class="text-[10px] text-zinc-600 font-bold uppercase tracking-widest">XP Acumulada</span>
                    </div>
                    <div class="bg-black/50 p-6 rounded-xl border border-white/5">
                        <span id="p-wins" class="block text-4xl font-black text-pink-500 font-orbitron">0</span>
                        <span class="text-[10px] text-zinc-600 font-bold uppercase tracking-widest">Victorias</span>
                    </div>
                </div>
                <button onclick="logout()" class="mt-12 text-red-500 text-[10px] font-black uppercase tracking-[0.3em]">Cerrar Terminal</button>
            </div>
        </section>

        <section id="view-soporte" class="view-section px-6 max-w-xl mx-auto">
            <div class="neon-panel p-8 rounded-xl">
                <h3 class="font-orbitron text-lg mb-8 text-cyan-400 uppercase tracking-widest">Centro de Soporte</h3>
                <div class="space-y-4">
                    <input id="s-asunto" placeholder="TEMA / ASUNTO" class="w-full bg-black/60 p-4 border border-white/10 outline-none text-xs rounded focus:border-cyan-400">
                    <textarea id="s-mensaje" rows="5" placeholder="DETALLES DEL PROBLEMA..." class="w-full bg-black/60 p-4 border border-white/10 outline-none text-xs rounded focus:border-cyan-400"></textarea>
                    <button onclick="enviarTicket()" class="w-full btn-arena">Enviar Se√±al</button>
                </div>
            </div>
        </section>

    </div>

    <script>
        // ############################################################
        // CONFIGURACI√ìN SUPABASE: PEGA TU URL Y KEY AQU√ç
        // ############################################################
        const SUPA_URL = 'https://qxvqxdsfcvdmanxtzmkn.supabase.co';
        const SUPA_KEY = 'sb_publishable_X2_itSXVSMUgkZeDLSE3KQ_HxD1Jf07';
        const _supa = supabase.createClient(SUPA_URL, SUPA_KEY);

        let currentUser = null;

        // --- MANEJO DE VISTAS ---
        function showView(viewId) {
            document.querySelectorAll('.view-section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            
            const target = document.getElementById('view-' + viewId);
            const link = document.getElementById('link-' + viewId);
            
            if(target) target.classList.add('active');
            if(link) link.classList.add('active');

            // Cargas espec√≠ficas
            if(viewId === 'torneos') cargarTorneos();
            if(viewId === 'ranking') cargarRanking();
            if(viewId === 'perfil') syncProfile();
            
            window.scrollTo(0,0);
        }

        // --- AUTENTICACI√ìN ---
        document.getElementById('auth-form').onsubmit = async (e) => {
            e.preventDefault();
            const email = document.getElementById('u-email').value;
            const pass = document.getElementById('u-pass').value;
            const btn = document.getElementById('btn-auth');
            const msg = document.getElementById('auth-msg');

            btn.innerText = "CONECTANDO...";
            msg.classList.add('hidden');

            const { data, error } = await _supa.auth.signInWithPassword({ email, password: pass });
            
            if(error) {
                // Si falla login, intentamos registro
                const { data: regData, error: regError } = await _supa.auth.signUp({ email, password: pass });
                if(regError) {
                    msg.innerText = "ERROR: " + regError.message;
                    msg.classList.remove('hidden');
                    btn.innerText = "INICIALIZAR";
                } else {
                    alert("¬°REGISTRO EXITOSO! Ahora inicia sesi√≥n con tus datos.");
                    btn.innerText = "INICIALIZAR";
                }
            }
        };

        // --- ESTADO DE SESI√ìN ---
        _supa.auth.onAuthStateChange(async (event, session) => {
            if (session) {
                currentUser = session.user;
                
                // 1. Verificar si tiene perfil, si no, crearlo (Fix para errores de registro)
                const { data: profile, error } = await _supa.from('perfiles').select('*').eq('id', currentUser.id).single();
                
                if(!profile) {
                    await _supa.from('perfiles').insert({ 
                        id: currentUser.id, 
                        nombre: currentUser.email.split('@')[0].toUpperCase(),
                        avatar_url: 'https://api.dicebear.com/7.x/avataaars/svg?seed=' + currentUser.id
                    });
                }

                // 2. Verificar Baneo
                if (profile && profile.baneado) {
                    document.body.innerHTML = `<div class='h-screen bg-black flex flex-col items-center justify-center text-red-500 font-orbitron p-10 text-center'>
                        <h1 class='text-4xl mb-4'>ACCESO DENEGADO</h1>
                        <p class='text-xs tracking-widest'>HAS SIDO EXPULSADO DE LA RED ARENA NEON.</p>
                    </div>`;
                    await _supa.auth.signOut();
                    return;
                }

                // 3. Entrar a la App
                document.getElementById('auth-screen').style.display = 'none';
                document.getElementById('main-app').classList.remove('hidden');
                document.getElementById('nav-user').innerText = profile?.nombre || "Guerrero";
                
                initApp();
            } else {
                document.getElementById('auth-screen').style.display = 'flex';
                document.getElementById('main-app').classList.add('hidden');
            }
        });

        // --- FUNCIONES DE LA APP ---
        function initApp() {
            syncProfile();
            checkAlerts();
            // Escuchar cambios en tiempo real
            _supa.channel('room1').on('postgres_changes', { event: '*', schema: 'public', table: 'alertas_globales' }, checkAlerts).subscribe();
            _supa.channel('room2').on('postgres_changes', { event: '*', schema: 'public', table: 'perfiles', filter: `id=eq.${currentUser.id}` }, syncProfile).subscribe();
        }

        async function syncProfile() {
            const { data } = await _supa.from('perfiles').select('*').eq('id', currentUser.id).single();
            if(data) {
                document.getElementById('p-nombre').innerText = data.nombre;
                document.getElementById('p-frase').innerText = data.frase_batalla || "Sin frase de batalla...";
                document.getElementById('p-xp').innerText = data.xp.toLocaleString();
                document.getElementById('p-wins').innerText = data.victorias;
                document.getElementById('p-img').src = data.avatar_url;
                document.getElementById('nav-user').innerText = data.nombre;
            }
        }

        async function cargarTorneos() {
            const { data } = await _supa.from('torneos').select('*').order('created_at', { ascending: false });
            const grid = document.getElementById('grid-torneos');
            if(!data || data.length === 0) {
                grid.innerHTML = "<p class='text-zinc-500 italic'>No hay torneos activos en este momento...</p>";
                return;
            }
            grid.innerHTML = data.map(t => `
                <div class="neon-panel p-6 rounded-xl relative overflow-hidden group">
                    <div class="absolute top-0 right-0 bg-cyan-400 text-black px-3 py-1 text-[8px] font-black uppercase">${t.juego}</div>
                    <h4 class="font-orbitron text-lg font-black italic mb-6 mt-2">${t.nombre}</h4>
                    <div class="flex justify-between text-[10px] font-bold text-zinc-500 mb-2 uppercase">
                        <span>Estado de Llenado</span>
                        <span class="text-cyan-400 font-orbitron">${t.inscritos}/${t.capacidad}</span>
                    </div>
                    <div class="h-1.5 w-full bg-white/5 mb-8 rounded-full overflow-hidden">
                        <div class="h-full bg-cyan-400 shadow-[0_0_10px_#00f2ff]" style="width: ${(t.inscritos/t.capacidad)*100}%"></div>
                    </div>
                    <button onclick="unirseTorneo('${t.id}', ${t.inscritos})" class="w-full btn-arena py-3 text-[9px]">Registrar Participaci√≥n</button>
                </div>
            `).join('');
        }

        async function unirseTorneo(id, actual) {
            const { error } = await _supa.from('torneos').update({ inscritos: actual + 1 }).eq('id', id);
            if(!error) alert("¬°REGISTRO EXITOSO! Prep√°rate para la batalla.");
            cargarTorneos();
        }

        async function cargarRanking() {
            const { data } = await _supa.from('perfiles').select('*').order('xp', { ascending: false }).limit(10);
            document.getElementById('list-ranking').innerHTML = data.map((u, i) => `
                <div class="flex items-center justify-between p-5 bg-white/5 border border-white/5 rounded-xl ${u.id === currentUser.id ? 'border-cyan-400/50 bg-cyan-400/5' : ''}">
                    <div class="flex items-center gap-5">
                        <span class="font-orbitron text-xl ${i < 3 ? 'text-yellow-500' : 'text-zinc-700'}">#${i+1}</span>
                        <img src="${u.avatar_url}" class="w-10 h-10 rounded-full border-2 border-white/10">
                        <div>
                            <span class="block text-sm font-black uppercase ${u.id === currentUser.id ? 'text-cyan-400' : ''}">${u.nombre}</span>
                            <span class="text-[9px] text-zinc-500 uppercase tracking-widest">${u.victorias} Victorias</span>
                        </div>
                    </div>
                    <span class="font-orbitron text-sm text-white font-black">${u.xp.toLocaleString()} <span class="text-[8px] text-zinc-500">XP</span></span>
                </div>
            `).join('');
        }

        async function checkAlerts() {
            const { data } = await _supa.from('alertas_globales').select('*').eq('activa', true).order('id', {ascending: false}).limit(1);
            const box = document.getElementById('global-alert');
            if(data && data.length > 0) {
                document.getElementById('alert-msg').innerText = data[0].mensaje;
                box.classList.remove('hidden');
            } else {
                box.classList.add('hidden');
            }
        }

        async function enviarTicket() {
            const asunto = document.getElementById('s-asunto').value;
            const mensaje = document.getElementById('s-mensaje').value;
            if(!asunto || !mensaje) return alert("Escribe el mensaje completo.");

            const { error } = await _supa.from('tickets_soporte').insert({ 
                user_id: currentUser.id, 
                asunto: asunto, 
                mensaje: mensaje 
            });

            if(!error) {
                alert("SE√ëAL ENVIADA. El comando revisar√° tu caso.");
                document.getElementById('s-asunto').value = "";
                document.getElementById('s-mensaje').value = "";
                showView('inicio');
            }
        }

        async function logout() {
            await _supa.auth.signOut();
            location.reload();
        }
    </script>
</body>
</html>
