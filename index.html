<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GAMER_NET | SOCIAL CORE</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Rajdhani:wght@500;700&family=Fira+Code:wght@400&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <style>
        :root { --neon: #00f2ff; --bg: #030508; --card: #0d1117; --success: #39FF14; --glass: rgba(13, 17, 23, 0.8); }
        * { box-sizing: border-box; outline: none; }
        body { margin: 0; background: var(--bg); color: #e0e6ed; font-family: 'Rajdhani', sans-serif; background-image: radial-gradient(circle at top right, #0a1120, #030508); background-attachment: fixed; }

        /* Pantallas */
        .screen { display: none; min-height: 100vh; flex-direction: column; padding-bottom: 70px; }
        .active { display: flex; }

        /* Login/Reg */
        .auth-container { display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; padding: 20px; }
        .auth-card { background: var(--card); padding: 30px; border-radius: 20px; border: 1px solid #1a1f26; width: 100%; max-width: 380px; box-shadow: 0 10px 40px rgba(0,0,0,0.8); }

        /* Navbar Inferior */
        .nav-bar { position: fixed; bottom: 0; width: 100%; background: var(--glass); backdrop-filter: blur(10px); display: flex; justify-content: space-around; padding: 12px; border-top: 1px solid #1a1f26; z-index: 1000; }
        .nav-item { color: #555; cursor: pointer; font-family: 'Orbitron'; font-size: 0.6rem; text-align: center; }
        .nav-item.active { color: var(--neon); text-shadow: 0 0 10px var(--neon); }

        /* Feed / Muro */
        .feed-post { background: var(--card); border-radius: 15px; padding: 15px; margin-bottom: 20px; border: 1px solid #1a1f26; }
        .admin-badge { background: var(--neon); color: #000; font-size: 0.6rem; padding: 2px 6px; border-radius: 4px; font-weight: bold; }

        /* Perfil */
        .profile-header { padding: 40px 20px; text-align: center; background: linear-gradient(0deg, var(--bg), #0d1117); }
        .avatar { width: 100px; height: 100px; border-radius: 50%; border: 3px solid var(--neon); margin-bottom: 10px; object-fit: cover; }

        /* Chat */
        .chat-area { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 10px; margin-top: 60px; }
        .msg { padding: 10px 15px; border-radius: 15px; max-width: 80%; font-size: 0.9rem; }
        .msg.me { align-self: flex-end; background: var(--neon); color: #000; border-bottom-right-radius: 2px; }
        .msg.others { align-self: flex-start; background: #1a1f26; border-bottom-left-radius: 2px; }

        /* Inputs & Buttons */
        input, textarea { width: 100%; padding: 12px; background: rgba(0,0,0,0.3); border: 1px solid #222; color: #fff; border-radius: 8px; margin-bottom: 10px; font-family: 'Rajdhani'; }
        .btn-action { background: var(--neon); color: #000; border: none; padding: 12px; border-radius: 8px; font-family: 'Orbitron'; font-weight: bold; cursor: pointer; width: 100%; }
        
        header { position: fixed; top: 0; width: 100%; padding: 15px; background: var(--glass); backdrop-filter: blur(10px); z-index: 900; border-bottom: 1px solid #1a1f26; display: flex; justify-content: space-between; align-items: center; }
    </style>
</head>
<body>

    <div id="screen-auth" class="screen auth-container active">
        <div class="auth-card" id="login-box">
            <h2 style="font-family:'Orbitron'; color:var(--neon)">CONECTAR_</h2>
            <input type="email" id="log-email" placeholder="Email">
            <input type="password" id="log-pass" placeholder="Password">
            <button class="btn-action" onclick="login()">ENTRAR</button>
            <p onclick="toggleAuth(false)" style="font-size: 0.7rem; margin-top: 15px; cursor: pointer;">¿Eres nuevo? Crea un perfil operativo</p>
        </div>
        <div class="auth-card" id="reg-box" style="display:none">
            <h2 style="font-family:'Orbitron'; color:var(--success)">REGISTRO_</h2>
            <input type="text" id="reg-nick" placeholder="Gamer Tag (Nick)">
            <input type="email" id="reg-email" placeholder="Email">
            <input type="password" id="reg-pass" placeholder="Password (Min. 6)">
            <button class="btn-action" style="background:var(--success)" onclick="registrar()">UNIRSE A LA RED</button>
            <p onclick="toggleAuth(true)" style="font-size: 0.7rem; margin-top: 15px; cursor: pointer;">Ya tengo cuenta, conectar</p>
        </div>
    </div>

    <div id="screen-feed" class="screen">
        <header><div style="font-family:'Orbitron'; color:var(--neon)">GAMER_NET</div></header>
        <div style="padding: 80px 20px 20px 20px;" id="feed-content">
            </div>
    </div>

    <div id="screen-tournaments" class="screen">
        <header><div style="font-family:'Orbitron'">TORNEOS_ACTIVOS</div></header>
        <div style="padding: 80px 20px 20px 20px;" id="tournament-list"></div>
    </div>

    <div id="screen-chat" class="screen" style="height: 100vh;">
        <header><div style="font-family:'Orbitron'">CANAL_GLOBAL</div></header>
        <div class="chat-area" id="chat-box"></div>
        <div style="padding: 10px; background: var(--card); display: flex; gap: 10px;">
            <input type="text" id="chat-input" placeholder="Escribe un mensaje..." style="margin:0">
            <button onclick="sendChat()" style="background:var(--neon); border:none; border-radius:8px; padding:0 20px;">></button>
        </div>
    </div>

    <div id="screen-profile" class="screen">
        <div class="profile-header">
            <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=Gamer" class="avatar" id="p-img">
            <h2 id="p-nick" style="margin:0; font-family:'Orbitron'">...</h2>
            <div id="p-xp" style="color:var(--success); font-weight:bold;">0 XP</div>
            <button onclick="auth.signOut()" style="margin-top:20px; background:none; border:1px solid #333; color:#555; padding:5px 15px; border-radius:20px;">LOGOUT</button>
        </div>
        <div style="padding: 20px;">
            <div style="font-family:'Orbitron'; font-size:0.7rem; color:#444; margin-bottom:10px;">PERSONALIZAR PERFIL</div>
            <input type="text" id="edit-bio" placeholder="Bio: Soy pro en League of Legends...">
            <button class="btn-action" style="font-size:0.7rem" onclick="updateProfile()">GUARDAR CAMBIOS</button>
        </div>
    </div>

    <nav class="nav-bar" id="app-nav" style="display:none">
        <div class="nav-item active" onclick="nav('screen-feed')">FEED</div>
        <div class="nav-item" onclick="nav('screen-tournaments')">EVENTOS</div>
        <div class="nav-item" onclick="nav('screen-chat')">CHAT</div>
        <div class="nav-item" onclick="nav('screen-profile')">PERFIL</div>
    </nav>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAyGsnbyvxTEzvtgOXSmU_5Hj6gS6TOWKM",
            authDomain: "gaming-team-18b95.firebaseapp.com",
            projectId: "gaming-team-18b95",
            storageBucket: "gaming-team-18b95.appspot.com",
            messagingSenderId: "89183017486",
            appId: "1:89183017486:web:18b6258a2bf5c0bde97a5f"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        let currentUserData = null;

        function nav(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
            event.currentTarget.classList.add('active');
        }

        function toggleAuth(isLogin) {
            document.getElementById('login-box').style.display = isLogin ? 'block' : 'none';
            document.getElementById('reg-box').style.display = isLogin ? 'none' : 'block';
        }

        // --- AUTH LOGIC ---
        window.registrar = () => {
            const nick = document.getElementById('reg-nick').value;
            const email = document.getElementById('reg-email').value;
            const pass = document.getElementById('reg-pass').value;
            auth.createUserWithEmailAndPassword(email, pass).then(cred => {
                return db.collection("usuarios").doc(cred.user.uid).set({
                    nick: nick, puntos: 0, bio: "", avatar: `https://api.dicebear.com/7.x/avataaars/svg?seed=${nick}`, email: email
                });
            }).catch(e => alert(e.message));
        };

        window.login = () => {
            auth.signInWithEmailAndPassword(document.getElementById('log-email').value, document.getElementById('log-pass').value)
            .catch(e => alert("Error de acceso"));
        };

        // --- REAL TIME ENGINE ---
        auth.onAuthStateChanged(user => {
            if(user) {
                document.getElementById('app-nav').style.display = 'flex';
                showScreen('screen-feed');
                
                // Sincronizar Perfil
                db.collection("usuarios").doc(user.uid).onSnapshot(doc => {
                    if(doc.exists) {
                        currentUserData = doc.data();
                        document.getElementById('p-nick').innerText = currentUserData.nick;
                        document.getElementById('p-xp').innerText = (currentUserData.puntos || 0) + " XP";
                        document.getElementById('p-img').src = currentUserData.avatar;
                    } else { auth.signOut(); }
                });

                // Cargar Feed (Muro del Admin)
                db.collection("chat_global").where("role", "==", "admin").orderBy("timestamp", "desc").onSnapshot(snap => {
                    const feed = document.getElementById('feed-content');
                    feed.innerHTML = "";
                    snap.forEach(doc => {
                        const m = doc.data();
                        feed.innerHTML += `
                            <div class="feed-post">
                                <span class="admin-badge">ADMIN_POST</span>
                                <div style="margin-top:10px; font-weight:500;">${m.text}</div>
                                <div style="font-size:0.6rem; color:#444; margin-top:10px;">PUBLICADO AHORA</div>
                            </div>
                        `;
                    });
                });

                // Cargar Torneos
                db.collection("torneos").onSnapshot(snap => {
                    const tList = document.getElementById('tournament-list');
                    tList.innerHTML = "";
                    snap.forEach(doc => {
                        const t = doc.data();
                        tList.innerHTML += `
                            <div class="feed-post" style="border-left:4px solid var(--neon)">
                                <div style="display:flex; justify-content:space-between">
                                    <b style="font-family:'Orbitron'">${t.nombre}</b>
                                    <span style="color:var(--neon)">${t.inscritos_count || 0}/${t.capacidad}</span>
                                </div>
                                <p style="font-size:0.8rem; color:#888;">${t.desc}</p>
                                <button class="btn-action" style="font-size:0.6rem; padding:8px" onclick="joinTournament('${doc.id}')">UNIRSE AL EVENTO</button>
                            </div>
                        `;
                    });
                });

                // Chat Global
                db.collection("chat_global").orderBy("timestamp", "desc").limit(30).onSnapshot(snap => {
                    const chat = document.getElementById('chat-box');
                    chat.innerHTML = "";
                    snap.docs.reverse().forEach(doc => {
                        const m = doc.data();
                        const isMe = m.uid === user.uid;
                        chat.innerHTML += `
                            <div class="msg ${isMe ? 'me' : 'others'}">
                                <div style="font-size:0.6rem; opacity:0.6; margin-bottom:3px;">${m.nick}</div>
                                ${m.text}
                            </div>
                        `;
                    });
                    chat.scrollTop = chat.scrollHeight;
                });

            } else {
                document.getElementById('app-nav').style.display = 'none';
                showScreen('screen-auth');
            }
        });

        window.sendChat = () => {
            const txt = document.getElementById('chat-input').value;
            if(!txt) return;
            db.collection("chat_global").add({
                nick: currentUserData.nick,
                text: txt,
                uid: auth.currentUser.uid,
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            });
            document.getElementById('chat-input').value = "";
        };

        window.updateProfile = () => {
            const bio = document.getElementById('edit-bio').value;
            db.collection("usuarios").doc(auth.currentUser.uid).update({ bio: bio });
            alert("Perfil actualizado");
        };

        window.joinTournament = (id) => {
            alert("Te has unido al torneo. El admin confirmará tu posición.");
        };

        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }
    </script>
</body>
</html>
